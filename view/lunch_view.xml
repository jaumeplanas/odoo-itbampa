<?xml version="1.0" encoding="UTF-8"?>
<openerp>
	<data>
		<!-- Report Action -->
		<report id="lunch_monthly_report_action" model="itbampa.lunch.report.wizard"
			string="Monthly Lunch Report" report_type="qweb-pdf"
			name="itbampa.lunch_monthly_report" file="itbampa.lunch_monthly_report"
			attachment_use="False" attachment="'LunchMonthlyReport.pdf'" />
		<!-- Report Wizard -->
		<record model="ir.ui.view" id="lunch_wizard_monthly_form_view">
			<field name="name">Monthly Lunch Report Wizard</field>
			<field name="model">itbampa.lunch.report.wizard</field>
			<field name="arch" type="xml">
				<form string="Monthly Lunch Report Wizard">
					<group>
						<p>
							This Wizards lets you select the required School Calendar that
							will be used to calculate monthly lunch attendance grouped by months.
						</p>
					</group>
					<group>
						<field name="school_calendar_id" string="Session selected"></field>
						<field name="month_id" string="Month" options='{"no_open": true, "no_create": true, "no_edit": true}'></field>
						<field name="lective_days"></field>
					</group>
					<group string="Monthly Lunch Attendance">
						<field name="line_ids" nolabel="1">
							<tree create="0" edit="0" delete="0">
								<field name="partner"></field>
								<field name="total"></field>
							</tree>						
						</field>
					</group>

					<footer>
						<button name="print_monthly_report" type="object" class="oe_highlight"
							string="Print Monthly Lunch Attendance" icon="STOCK_PRINT">
						</button>
						<button special="cancel" string="Cancel"></button>
					</footer>
				</form>
			</field>
		</record>
		<record id="lunch_monthly_report_wizard" model="ir.actions.act_window">
			<field name="name">Lunch Monthly Report Wizard</field>
			<field name="res_model">itbampa.lunch.report.wizard</field>
			<field name="target">new</field>
		</record>
		<record model="ir.actions.act_window.view" id="lunch_monthly_report_wizard_form">
			<field name="view_mode">form</field>
			<field name="view_id" ref="lunch_wizard_monthly_form_view" />
			<field name="act_window_id" ref="lunch_monthly_report_wizard" />
		</record>
		<!-- Lunch Daily Report -->
		<report attachment="'LlistatMenjador'+object.date_start+'.pdf'"
			attachment_use="False" id="report_lunch_event_pdf" model="itbampa.lunch.event"
			name="itbampa.report_lunch_event" report_type="qweb-pdf" string="Print Lunch Event" />
		<!-- Lunch Tree View -->
		<record id="itbampa_lunch_tree" model="ir.ui.view">
			<field name="name">Lunchs</field>
			<field name="model">itbampa.lunch.event</field>
			<field name="arch" type="xml">
				<tree string="Lunchs">
					<field name="date_start" />
					<field name="state" />
					<field name="total_eaters" />
					<field invisible="1" name="user_id" />
				</tree>
			</field>
		</record>
		<!-- Lunch Form View -->
		<record id="itbampa_lunch_form" model="ir.ui.view">
			<field name="name">Lunchs</field>
			<field name="model">itbampa.lunch.event</field>
			<field name="arch" type="xml">
				<form string="Lunchs">
					<header>
						<button class="oe_highlight" groups="itbampa.group_itbampa_admin"
							name="close_lunch_event" states="open" string="Close Lunch Event"
							type="workflow" />
						<button class="oe_highlight" groups="itbampa.group_itbampa_admin"
							name="open_lunch_event" states="closed" string="Open Lunch Event"
							type="workflow" />
						<field name="state" widget="statusbar" />
					</header>
					<sheet>
						<div class="oe_title">
							<h1>
								<label for="name" string="Fitxa del menjador del dia" />
								<field class="oe_inline" name="name" readonly="1" />
							</h1>
						</div>
						<div class="oe_right" name="buttons">
							<button name="%(report_lunch_event_pdf)d" string="Attendance"
								type="action" class="fa fa-check-square-o" />
							<button name="update_with_registered" string="Update Members"
								type="object" class="fa fa-users"></button>
						</div>
						<separator string="General Info"></separator>
						<group col="4">
							<field attrs="{'readonly': [('state', '!=', 'open')]}"
								name="date_start" string="Date" />
							<field name="total_eaters" />
							<field invisible="1" name="user_id" />
						</group>
						<group string="Eaters">
							<field attrs="{'readonly': [('state', '!=', 'open')]}"
								name="eater_ids" nolabel="1">
								<tree editable="bottom" string="Eaters" default_order="partner_current_course, partner_id">
									<field name="partner_id" />
									<field name="partner_current_course"></field>
									<field
										domain="[('categ_id', 'child_of', %(itbampa.product_category_lunch)d)]"
										name="lunch_product_id" />
									<field name="comment" />
								</tree>
							</field>
						</group>
					</sheet>
				</form>
			</field>
		</record>
		<!-- Lunch Calendar View -->
		<record id="itbampa_lunch_calendar" model="ir.ui.view">
			<field name="name">Events</field>
			<field name="model">itbampa.lunch.event</field>
			<field name="arch" type="xml">
				<calendar all_day="all_day" color="user_id" date_start="date_start"
					display="Total [total_eaters]" quick_add="0" string="Lunchs">
					<field name="name" />
					<field name="total_eaters" />
					<field name="state" />
				</calendar>
			</field>
		</record>
		<!-- Lunch actions -->
		<record id="action_itbampa_lunchs" model="ir.actions.act_window">
			<field name="name">Lunchs</field>
			<field name="res_model">itbampa.lunch.event</field>
			<field name="view_mode">calendar,tree,form</field>
		</record>
		<record id="action_itbampa_lunchs_view_tree" model="ir.actions.act_window.view">
			<field eval="2" name="sequence" />
			<field name="view_mode">tree</field>
			<field name="view_id" ref="itbampa_lunch_tree" />
			<field name="act_window_id" ref="action_itbampa_lunchs" />
		</record>
		<record id="action_itbampa_lunchs_view_form" model="ir.actions.act_window.view">
			<field eval="3" name="sequence" />
			<field name="view_mode">form</field>
			<field name="view_id" ref="itbampa_lunch_form" />
			<field name="act_window_id" ref="action_itbampa_lunchs" />
		</record>
		<record id="action_itbampa_lunchs_view_calendar" model="ir.actions.act_window.view">
			<field eval="1" name="sequence" />
			<field name="view_mode">calendar</field>
			<field name="view_id" ref="itbampa_lunch_calendar" />
			<field name="act_window_id" ref="action_itbampa_lunchs" />
		</record>
		<!-- Lunch Menu -->
		<menuitem action="action_itbampa_lunchs" id="menu_itbampa_mngt_lunchs"
			name="Lunchs" parent="menu_itbampa_mgnt" sequence="30" />
		<menuitem action="lunch_monthly_report_wizard" id="menu_itbampa_report_monthly"
			name="Lunch Monthly Report" parent="menu_itbampa_report" sequence="10" />
	</data>
</openerp>
