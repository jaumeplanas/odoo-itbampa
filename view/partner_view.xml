<?xml version="1.0" encoding="UTF-8"?>
<openerp>
  <data>
    <!-- Tree View for Members -->
    <record model="ir.ui.view" id="itbampa_members_tree">
      <field name="name">Members</field>
      <field name="model">res.partner</field>
      <field name="arch" type="xml">
        <tree string="Members">
          <field name="name"/>
          <field name="ampa_partner_type"/>
          <field name="current_course" attrs="{'invisible': [('ampa_partner_type', '!=', 'student')]}"/>
          <field name="billing_partner_id" attrs="{'invisible': [('ampa_partner_type', '!=', 'student')]}"/>
          <field name="user_id" invisible="1"/>
        </tree>
      </field>
    </record>
    <!-- Filter View for Members -->
    <record model="ir.ui.view" id="itbampa_members_filter">
      <field name="name">res.partner.select</field>
      <field name="model">res.partner</field>
      <field name="priority">50</field>
      <field name="arch" type="xml">
        <search string="Partners">
          <field string="Name" name="name"/>
          <field string="Current Course" name="current_course"/>
          <filter string="Students" name="student" domain="[('ampa_partner_type','=','student')]" help="Students"/>
          <filter string="Tutors" name="tutor" domain="[('ampa_partner_type','=','tutor')]" help="Tutors"/>
          <filter string="Current Course" domain="[]" context="{'group_by':'current_course'}"/>
        </search>
      </field>
    </record>
    <!-- Inherited Form View -->
    <record model="ir.ui.view" id="view_partner_form">
        <field name="name">res.partner.form.inherit</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//page[@name='internal_notes']" position="before">
                <page string="AMPA">
                    <group>
                        <group>
                            <field name="ampa_partner_type"/>
                            <field name="billing_partner_id" attrs="{'invisible': [('ampa_partner_type', '!=', 'student')]}" domain="[('ampa_partner_type', '=', 'tutor')]" />
                        </group>
                        <group>
                            <field name="ampa_birthdate" attrs="{'invisible': [('ampa_partner_type', '!=', 'student')]}"/>
                            <field name="course_lag" attrs="{'invisible': [('ampa_partner_type', '!=', 'student')]}"/>
                            <field name="current_course" attrs="{'invisible': [('ampa_partner_type', '!=', 'student')]}"/>
                        </group>
                    </group>
                    <group string="Children" attrs="{'invisible': [('ampa_partner_type', '!=', 'tutor')]}">
                        <field name="partner_child_ids" nolabel="1" domain="[('ampa_partner_type', '=', 'student')]">
                            <tree string="Members">
                                <field name="name"/>
                                <field name="ampa_partner_type"/>
                                <field name="ampa_birthdate"/>
                                <field name="current_course"/>
                                <field name="billing_partner_id"/>
                            </tree>
                        </field>
                    </group>
                    <group string="Tutors" attrs="{'invisible': [('ampa_partner_type', '!=', 'student')]}">
                        <field name="partner_tutor_ids" nolabel="1" domain="[('ampa_partner_type', '=', 'tutor')]">
                            <tree string="Members">
                                <field name="name"/>
                                <field name="ampa_partner_type"/>
                            </tree>
                        </field>
                    </group>
                </page>
            </xpath>
        </field>
    </record>     <!-- Action records -->
    <record id="action_itbampa_partners" model="ir.actions.act_window">
      <field name="name">Members</field>
      <field name="res_model">res.partner</field>
      <field name="search_view_id" ref="itbampa_members_filter"/>
      <field name="context">{"search_default_student": 1}</field>
    </record>
    <record model="ir.actions.act_window.view" id="action_membership_members_view_tree">
      <field name="sequence" eval="2"/>
      <field name="view_mode">tree</field>
      <field name="view_id" ref="itbampa_members_tree"/>
      <field name="act_window_id" ref="action_itbampa_partners"/>
    </record>
    <record model="ir.actions.act_window.view" id="action_membership_members_view_form">
      <field name="sequence" eval="3"/>
      <field name="view_mode">form</field>
      <field name="view_id" ref="base.view_partner_form"/>
      <field name="act_window_id" ref="action_itbampa_partners"/>
    </record>
    <record model="ir.actions.act_window.view" id="action_membership_members_view_kanban">
      <field name="sequence" eval="1"/>
      <field name="view_mode">kanban</field>
      <field name="view_id" ref="base.res_partner_kanban_view"/>
      <field name="act_window_id" ref="action_itbampa_partners"/>
    </record>
    <!-- Menu Record -->
    <menuitem name="Members" id="menu_itbampa_mngt_members" sequence="10" parent="menu_itbampa_mgnt" action="action_itbampa_partners" />
  </data>
</openerp>
